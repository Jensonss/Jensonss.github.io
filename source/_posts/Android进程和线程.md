---
title: Android进程和线程
date: 2017-04-27 20:36:13
tags: Android
categories: Android
---

# 进程

一般情况下，进程是应用程序的单元，一个应用对应一个进程同时对应一个主线程。但是通过设置 `android:process`，可以使原本一个应用中的组件运行在多个进程中。

> 如果进程名称设置为“:remote”，那么这个进程的名字是包名+设置的名字，以冒号开头的进程属于私有进程，其他应用的组件不能和它跑在一个进程。如果进程名设置是完整的("非冒号开头")，则属于全局进程，其他应用可以通过shareUID方式和它共享一个进程。

# 进程优先级分类

根据进程的优先级可以分为五级，

- 前台进程

  用户当前操作所必需的进程。如果一个进程满足以下任一条件，即视为前台进程：
  ​	托管用户正在交互的 Activity（已调用 Activity 的 onResume() 方法）
  ​	托管某个 Service，后者绑定到用户正在交互的 Activity
  ​	托管正在“前台”运行的 Service（服务已调用 startForeground()）
  ​	托管正执行一个生命周期回调的 Service（onCreate()、onStart() 或 onDestroy()）
  ​	托管正执行其 onReceive() 方法的 BroadcastReceiver
  通常，在任意给定时间前台进程都为数不多。只有在内存不足以支持它们同时继续运行这一万不得已的情况下，系统才会终止它们。 此时，设备往往已达到内存分页状态，因此需要终止一些前台进程来确保用户界面正常响应。

- 可见进程

  没有任何前台组件、但仍会影响用户在屏幕上所见内容的进程。 如果一个进程满足以下任一条件，即视为可见进程：
  ​	托管不在前台、但仍对用户可见的 Activity（已调用其 onPause() 方法）。例如，如果前台 Activity 启动了一个对话框，允许在其后显示上一 Activity，则有可能会发生这种情况。
  ​	托管绑定到可见（或前台）Activity 的 Service。
  可见进程被视为是极其重要的进程，除非为了维持所有前台进程同时运行而必须终止，否则系统不会终止这些进程。

- 服务进程

  正在运行已使用 startService() 方法启动的服务且不属于上述两个更高类别进程的进程。尽管服务进程与用户所见内容没有直接关联，但是它们通常在执行一些用户关心的操作（例如，在后台播放音乐或从网络下载数据）。因此，除非内存不足以维持所有前台进程和可见进程同时运行，否则系统会让服务进程保持运行状态。

- 后台进程

  包含目前对用户不可见的 Activity 的进程（已调用 Activity 的 onStop() 方法）。这些进程对用户体验没有直接影响，系统可能随时终止它们，以回收内存供前台进程、可见进程或服务进程使用。 通常会有很多后台进程在运行，因此它们会保存在 LRU （最近最少使用）列表中，以确保包含用户最近查看的 Activity 的进程最后一个被终止。如果某个 Activity 正确实现了生命周期方法，并保存了其当前状态，则终止其进程不会对用户体验产生明显影响，因为当用户导航回该 Activity 时，Activity 会恢复其所有可见状态。 有关保存和恢复状态的信息，请参阅 Activity文档。

- 空进程

  不含任何活动应用组件的进程。保留这种进程的的唯一目的是用作缓存，以缩短下次在其中运行组件所需的启动时间。 为使总体系统资源在进程缓存和底层内核缓存之间保持平衡，系统往往会终止这些进程。

# 线程

线程可以看作是一个轻量级的进程，在Android中启动应用时系统会为APP创建一个UI线程，Android UI是非线程安全的。

在Android开发中注意两点：

①不能在UI线程以外的其他线程操作UI，否则异常。

②不能阻塞UI线程，否则ANR。

当然在某些特殊条件下，非UI线程操作 UI没有报错，参考我的[[为什么我在工作线程刷新UI没报错？](http://www.jensondev.me/2017/04/21/%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E5%9C%A8%E5%B7%A5%E4%BD%9C%E7%BA%BF%E7%A8%8B%E5%88%B7%E6%96%B0UI%E6%B2%A1%E6%8A%A5%E9%94%99/)] 。

Android 提供了几种途径来从其他线程访问 UI 线程。 以下列出了几种有用的方法：

Activity.runOnUiThread(Runnable)
View.post(Runnable)
View.postDelayed(Runnable, long)

